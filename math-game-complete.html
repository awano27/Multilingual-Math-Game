<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Dungeon - Complete Edition</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes heroFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        @keyframes monsterFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-8px) scale(1.05); }
        }
        @keyframes bossFloat {
            0%, 100% { transform: translateY(0px) scale(1) rotate(0deg); }
            25% { transform: translateY(-5px) scale(1.05) rotate(-5deg); }
            50% { transform: translateY(-10px) scale(1.1) rotate(0deg); }
            75% { transform: translateY(-5px) scale(1.05) rotate(5deg); }
        }
        @keyframes goalRotate {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }
        .animate-hero { animation: heroFloat 2s ease-in-out infinite; }
        .animate-monster { animation: monsterFloat 3s ease-in-out infinite; }
        .animate-boss { animation: bossFloat 1.5s ease-in-out infinite; }
        .animate-goal { animation: goalRotate 3s linear infinite; }
        
        /* Prevent text selection and zooming on mobile */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        /* Heart icon styles */
        .heart {
            display: inline-block;
            width: 30px;
            height: 30px;
        }
        .heart.filled {
            color: #ef4444;
        }
        .heart.empty {
            color: #d1d5db;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        const MathMazeGame = () => {
            // Language settings
            const [language, setLanguage] = useState('ja');
            
            // Translations (all languages)
            const translations = {
                ja: {
                    gameTitle: 'ã•ã‚“ã™ã†ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³',
                    startGame: 'ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼',
                    stats: 'ã›ã„ã›ã',
                    dictionary: 'ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãšã‹ã‚“',
                    selectGrade: 'ãŒãã­ã‚“ã‚’ ãˆã‚‰ã¼ã†ï¼',
                    grade2Mode: '2å¹´ç”Ÿãƒ¢ãƒ¼ãƒ‰',
                    grade3Mode: '3å¹´ç”Ÿãƒ¢ãƒ¼ãƒ‰',
                    studyContent: 'ã¹ã‚“ãã‚‡ã†ã™ã‚‹å†…å®¹ï¼š',
                    addition: 'ãŸã—ç®—',
                    subtraction: 'ã²ãç®—',
                    comparison: 'æ•°ã®å¤§å°ãã‚‰ã¹',
                    multiplication: 'ã‹ã‘ç®—ï¼ˆä¹ä¹ï¼‰',
                    division: 'ã‚ã‚Šç®—ï¼ˆã‚ã¾ã‚Šãªã—ï¼‰',
                    back: 'ã‚‚ã©ã‚‹',
                    level: 'ãƒ¬ãƒ™ãƒ«',
                    defeated: 'ãŸãŠã—ãŸ',
                    timeLeft: 'ã®ã“ã‚Šæ™‚é–“',
                    seconds: 'ç§’',
                    correct: 'ã›ã„ã‹ã„ï¼ã™ã”ã„ã­ï¼',
                    incorrect: 'ã–ã‚“ã­ã‚“ï¼ã‚‚ã†ã„ã¡ã©ï¼',
                    timeUp: 'ã˜ã‹ã‚“ãŽã‚Œï¼ã‚‚ã†ã„ã¡ã©ï¼',
                    wall: 'ã‹ã¹ã ã‚ˆï¼ã¹ã¤ã®é“ã‚’ã•ãŒãã†ï¼',
                    gateBlocked: 'ãƒœã‚¹ã‚’ãŸãŠã•ãªã„ã¨ ã¨ãŠã‚Œãªã„ï¼',
                    gateOpened: 'ã‚²ãƒ¼ãƒˆãŒã²ã‚‰ã„ãŸï¼',
                    bossDefeated: 'ãƒœã‚¹ã‚’ãŸãŠã—ãŸï¼ã‚²ãƒ¼ãƒˆãŒã²ã‚‰ãã‚ˆï¼',
                    monsterDefeated: 'ã‚’ãŸãŠã—ãŸï¼',
                    levelClear: 'ãƒ¬ãƒ™ãƒ«',
                    clearMessage: 'ã‚¯ãƒªã‚¢ï¼',
                    nextLevel: 'ã¤ãŽã®ãƒ¬ãƒ™ãƒ«ã¸ï¼',
                    menu: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸',
                    becomeHero: 'ã•ã‚“ã™ã†å‹‡è€…ã«ãªã£ã¦',
                    conquerDungeon: 'ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚’åˆ¶è¦‡ã—ã‚ˆã†ï¼',
                    dungeonExploring: 'ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³æŽ¢ç´¢ä¸­',
                    bossBattle: 'ãƒœã‚¹ãƒãƒˆãƒ«ï¼',
                    appeared: 'ãŒã‚ã‚‰ã‚ã‚ŒãŸï¼',
                    bossWarning: 'ã“ã®ãƒœã‚¹ã‚’ãŸãŠã•ãªã„ã¨ ã‚´ãƒ¼ãƒ«ã§ããªã„ï¼',
                    defeatedBoss: 'ãƒœã‚¹ã‚’ãŸãŠã—ãŸï¼ã‚´ãƒ¼ãƒ«ã¸å‘ã‹ãŠã†ï¼',
                    needDefeatBoss: 'ãƒœã‚¹ã‚’ãŸãŠã•ãªã„ã¨ã‚´ãƒ¼ãƒ«ã§ããªã„ï¼',
                    you: 'ã˜ã¶ã‚“',
                    monster: 'ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼',
                    boss: 'ãƒœã‚¹',
                    gate: 'ã‚²ãƒ¼ãƒˆ',
                    goal: 'ã‚´ãƒ¼ãƒ«',
                    totalDefeated: 'ãœã‚“ã¶ã§ãŸãŠã—ãŸãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼',
                    totalQuestions: 'ã¨ã„ãŸã‚‚ã‚“ã ã„',
                    correctAnswers: 'ã›ã„ã‹ã„ã—ãŸã‚‚ã‚“ã ã„',
                    accuracy: 'ã›ã„ã‹ã„çŽ‡',
                    congratulations: 'ãŠã‚ã§ã¨ã†ï¼',
                    yourStats: 'ãã¿ã®ã›ã„ã›ã',
                    found: 'ã¿ã¤ã‘ãŸ',
                    notFound: 'ã¾ã ã¿ã¤ã‘ã¦ã„ãªã„ã‚ˆ',
                    hp: 'ãŸã„ã‚Šã‚‡ã',
                    whichBigger: 'ã©ã¡ã‚‰ãŒå¤§ãã„ï¼Ÿ',
                    body: 'ä½“',
                    question: 'å•',
                    badges: 'ãƒãƒƒã‚¸',
                    firstClear: 'ã¯ã˜ã‚ã¦ã®ã‚¯ãƒªã‚¢',
                    perfectClear: 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆ',
                    multiplicationMaster: 'ä¹ä¹ãƒžã‚¹ã‚¿ãƒ¼',
                    typesOfMonsters: 'ã—ã‚…ã‚‹ã„ã®ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼',
                    hint: 'ãƒ’ãƒ³ãƒˆ: ã˜ã¶ã‚“ã®å­¦å¹´ã«ã‚ã£ãŸãƒ¢ãƒ¼ãƒ‰ã‚’ãˆã‚‰ã¼ã†ï¼',
                    viewHint: 'ãƒ’ãƒ³ãƒˆã‚’ã¿ã‚‹',
                    hideHint: 'ãƒ’ãƒ³ãƒˆã‚’éš ã™',
                    insectMission: 'è™«å–ã‚ŠãƒŸãƒƒã‚·ãƒ§ãƒ³',
                    selectArea: 'ã‚¨ãƒªã‚¢ã‚’é¸ã¼ã†',
                    urawa: 'æµ¦å’Œ',
                    omiya: 'å¤§å®®',
                    iwatsuki: 'å²©æ§»',
                    cicada: 'ã‚»ãƒŸ',
                    cicadaFact: 'å¤§å®®å…¬åœ’ã§ã¯ã‚»ãƒŸãŒãŸãã•ã‚“é³´ã„ã¦ã„ã‚‹ã‚ˆã€‚',
                    beetle: 'ã‚«ãƒ–ãƒˆãƒ ã‚·',
                    beetleFact: 'æµ¦å’Œã§ã¯ã‚«ãƒ–ãƒˆãƒ ã‚·ãŒäººæ°—ã ã‚ˆã€‚',
                    dragonfly: 'ãƒˆãƒ³ãƒœ',
                    dragonflyFact: 'è¦‹æ²¼ç”°ã‚“ã¼ã§ã¯ãƒˆãƒ³ãƒœãŒé£›ã³å›žã£ã¦ã„ã‚‹ã‚ˆã€‚',
                    attemptCapture: 'æ•ç²ã«æŒ‘æˆ¦',
                    captureInsect: 'è™«ã‚’æ•ã¾ãˆã‚ˆã†',
                    captureSuccess: 'æ•ç²æˆåŠŸï¼',
                    captureFail: 'é€ƒã’ã‚‰ã‚ŒãŸï¼'
                },
                en: {
                    gameTitle: 'Math Dungeon',
                    startGame: 'Start Game!',
                    stats: 'Statistics',
                    dictionary: 'Monster Guide',
                    selectGrade: 'Choose Your Grade!',
                    grade2Mode: 'Grade 2 Mode',
                    grade3Mode: 'Grade 3 Mode',
                    studyContent: 'What to Study:',
                    addition: 'Addition',
                    subtraction: 'Subtraction',
                    comparison: 'Number Comparison',
                    multiplication: 'Multiplication',
                    division: 'Division',
                    back: 'Back',
                    level: 'Level',
                    defeated: 'Defeated',
                    timeLeft: 'Time Left',
                    seconds: 'sec',
                    correct: 'Correct! Great job!',
                    incorrect: 'Try again!',
                    timeUp: "Time's up! Try again!",
                    wall: "It's a wall! Find another way!",
                    gateBlocked: 'Defeat the boss to pass!',
                    gateOpened: 'Gate opened!',
                    bossDefeated: 'Boss defeated! Gate will open!',
                    monsterDefeated: ' defeated!',
                    levelClear: 'Level',
                    clearMessage: 'Clear!',
                    nextLevel: 'Next Level!',
                    menu: 'Menu',
                    becomeHero: 'Become a Math Hero',
                    conquerDungeon: 'Conquer the Dungeon!',
                    dungeonExploring: 'Exploring Dungeon',
                    bossBattle: 'Boss Battle!',
                    appeared: ' appeared!',
                    bossWarning: 'Defeat this boss to reach the goal!',
                    defeatedBoss: 'Boss defeated! Head to the goal!',
                    needDefeatBoss: 'Defeat the boss to reach the goal!',
                    you: 'You',
                    monster: 'Monster',
                    boss: 'Boss',
                    gate: 'Gate',
                    goal: 'Goal',
                    totalDefeated: 'Total Monsters Defeated',
                    totalQuestions: 'Questions Answered',
                    correctAnswers: 'Correct Answers',
                    accuracy: 'Accuracy',
                    congratulations: 'Congratulations!',
                    yourStats: 'Your Statistics',
                    found: 'Found',
                    notFound: 'Not discovered yet',
                    hp: 'HP',
                    whichBigger: 'Which is bigger?',
                    body: ' monsters',
                    question: ' questions',
                    badges: 'Badges',
                    firstClear: 'First Clear',
                    perfectClear: 'Perfect',
                    multiplicationMaster: 'Times Table Master',
                    typesOfMonsters: 'types of monsters',
                    hint: 'Hint: Choose the mode for your grade level!',
                    viewHint: 'Show Hint',
                    hideHint: 'Hide Hint',
                    insectMission: 'Insect Mission',
                    selectArea: 'Select Area',
                    urawa: 'Urawa',
                    omiya: 'Omiya',
                    iwatsuki: 'Iwatsuki',
                    cicada: 'Cicada',
                    cicadaFact: 'Many cicadas sing in Omiya Park.',
                    beetle: 'Beetle',
                    beetleFact: 'Beetles are popular in Urawa.',
                    dragonfly: 'Dragonfly',
                    dragonflyFact: 'Dragonflies fly around Minuma Tambo.',
                    attemptCapture: 'Attempt Capture',
                    captureInsect: 'Catch the insect',
                    captureSuccess: 'Captured!',
                    captureFail: 'It escaped!'
                },
                fr: {
                    gameTitle: 'Donjon des Maths',
                    startGame: 'Commencer!',
                    stats: 'Statistiques',
                    dictionary: 'Guide des Monstres',
                    selectGrade: 'Choisissez votre niveau!',
                    grade2Mode: 'Mode 2e annÃ©e',
                    grade3Mode: 'Mode 3e annÃ©e',
                    studyContent: 'Ã€ Ã©tudier:',
                    addition: 'Addition',
                    subtraction: 'Soustraction',
                    comparison: 'Comparaison',
                    multiplication: 'Multiplication',
                    division: 'Division',
                    back: 'Retour',
                    level: 'Niveau',
                    defeated: 'Vaincus',
                    timeLeft: 'Temps restant',
                    seconds: 'sec',
                    correct: 'Correct! Bravo!',
                    incorrect: 'Essaie encore!',
                    timeUp: 'Temps Ã©coulÃ©!',
                    wall: "C'est un mur!",
                    gateBlocked: 'Vaincs le boss pour passer!',
                    gateOpened: 'Porte ouverte!',
                    bossDefeated: 'Boss vaincu!',
                    monsterDefeated: ' vaincu!',
                    levelClear: 'Niveau',
                    clearMessage: 'RÃ©ussi!',
                    nextLevel: 'Niveau suivant!',
                    menu: 'Menu',
                    becomeHero: 'Deviens un hÃ©ros des maths',
                    conquerDungeon: 'Conquiers le donjon!',
                    dungeonExploring: 'Exploration du donjon',
                    bossBattle: 'Combat de boss!',
                    appeared: ' est apparu!',
                    bossWarning: 'Vaincs ce boss pour atteindre le but!',
                    defeatedBoss: 'Boss vaincu! Dirige-toi vers le but!',
                    needDefeatBoss: 'Vaincs le boss pour atteindre le but!',
                    you: 'Toi',
                    monster: 'Monstre',
                    boss: 'Boss',
                    gate: 'Porte',
                    goal: 'But',
                    totalDefeated: 'Total de monstres vaincus',
                    totalQuestions: 'Questions rÃ©pondues',
                    correctAnswers: 'Bonnes rÃ©ponses',
                    accuracy: 'PrÃ©cision',
                    congratulations: 'FÃ©licitations!',
                    yourStats: 'Tes Statistiques',
                    found: 'TrouvÃ©',
                    notFound: 'Pas encore dÃ©couvert',
                    hp: 'PV',
                    whichBigger: 'Lequel est plus grand?',
                    body: ' monstres',
                    question: ' questions',
                    badges: 'Badges',
                    firstClear: 'PremiÃ¨re victoire',
                    perfectClear: 'Parfait',
                    multiplicationMaster: 'MaÃ®tre des tables',
                    typesOfMonsters: 'types de monstres',
                    hint: 'Astuce: Choisis le mode pour ton niveau!',
                    viewHint: "Voir l'indice",
                    hideHint: "Cacher l'indice",
                    insectMission: 'Mission Insecte',
                    selectArea: 'Choisir une zone',
                    urawa: 'Urawa',
                    omiya: 'Omiya',
                    iwatsuki: 'Iwatsuki',
                    cicada: 'Cigale',
                    cicadaFact: 'Beaucoup de cigales chantent au parc Omiya.',
                    beetle: 'ScarabÃ©e',
                    beetleFact: 'Les scarabÃ©es sont populaires Ã  Urawa.',
                    dragonfly: 'Libellule',
                    dragonflyFact: 'Les libellules volent autour de Minuma Tambo.',
                    attemptCapture: 'Tenter la capture',
                    captureInsect: "Attrape l'insecte",
                    captureSuccess: 'CapturÃ©!',
                    captureFail: 'S\'est Ã©chappÃ©!'
                },
                zh: {
                    gameTitle: 'æ•°å­¦åœ°ç‰¢',
                    startGame: 'å¼€å§‹æ¸¸æˆï¼',
                    stats: 'ç»Ÿè®¡',
                    dictionary: 'æ€ªç‰©å›¾é‰´',
                    selectGrade: 'é€‰æ‹©å¹´çº§ï¼',
                    grade2Mode: 'äºŒå¹´çº§æ¨¡å¼',
                    grade3Mode: 'ä¸‰å¹´çº§æ¨¡å¼',
                    studyContent: 'å­¦ä¹ å†…å®¹ï¼š',
                    addition: 'åŠ æ³•',
                    subtraction: 'å‡æ³•',
                    comparison: 'æ•°å­—æ¯”è¾ƒ',
                    multiplication: 'ä¹˜æ³•',
                    division: 'é™¤æ³•',
                    back: 'è¿”å›ž',
                    level: 'å…³å¡',
                    defeated: 'å‡»è´¥',
                    timeLeft: 'å‰©ä½™æ—¶é—´',
                    seconds: 'ç§’',
                    correct: 'æ­£ç¡®ï¼å¤ªæ£’äº†ï¼',
                    incorrect: 'å†è¯•ä¸€æ¬¡ï¼',
                    timeUp: 'æ—¶é—´åˆ°ï¼',
                    wall: 'æ˜¯å¢™ï¼',
                    gateBlocked: 'å‡»è´¥bossæ‰èƒ½é€šè¿‡ï¼',
                    gateOpened: 'å¤§é—¨æ‰“å¼€äº†ï¼',
                    bossDefeated: 'Bossè¢«å‡»è´¥ï¼',
                    monsterDefeated: 'è¢«å‡»è´¥ï¼',
                    levelClear: 'å…³å¡',
                    clearMessage: 'é€šå…³ï¼',
                    nextLevel: 'ä¸‹ä¸€å…³ï¼',
                    menu: 'èœå•',
                    becomeHero: 'æˆä¸ºæ•°å­¦è‹±é›„',
                    conquerDungeon: 'å¾æœåœ°ç‰¢ï¼',
                    dungeonExploring: 'æŽ¢ç´¢åœ°ç‰¢ä¸­',
                    bossBattle: 'Bossæˆ˜ï¼',
                    appeared: 'å‡ºçŽ°äº†ï¼',
                    bossWarning: 'å‡»è´¥è¿™ä¸ªbossæ‰èƒ½åˆ°è¾¾ç»ˆç‚¹ï¼',
                    defeatedBoss: 'Bossè¢«å‡»è´¥ï¼å‰å¾€ç»ˆç‚¹ï¼',
                    needDefeatBoss: 'å‡»è´¥bossæ‰èƒ½åˆ°è¾¾ç»ˆç‚¹ï¼',
                    you: 'ä½ ',
                    monster: 'æ€ªç‰©',
                    boss: 'Boss',
                    gate: 'å¤§é—¨',
                    goal: 'ç»ˆç‚¹',
                    totalDefeated: 'å‡»è´¥æ€ªç‰©æ€»æ•°',
                    totalQuestions: 'å›žç­”é—®é¢˜æ•°',
                    correctAnswers: 'æ­£ç¡®ç­”æ¡ˆæ•°',
                    accuracy: 'æ­£ç¡®çŽ‡',
                    congratulations: 'æ­å–œï¼',
                    yourStats: 'ä½ çš„ç»Ÿè®¡',
                    found: 'å·²å‘çŽ°',
                    notFound: 'å°šæœªå‘çŽ°',
                    hp: 'ç”Ÿå‘½å€¼',
                    whichBigger: 'å“ªä¸ªæ›´å¤§ï¼Ÿ',
                    body: 'åª',
                    question: 'é¢˜',
                    badges: 'å¾½ç« ',
                    firstClear: 'é¦–æ¬¡é€šå…³',
                    perfectClear: 'å®Œç¾Ž',
                    multiplicationMaster: 'ä¹ä¹è¡¨å¤§å¸ˆ',
                    typesOfMonsters: 'ç§æ€ªç‰©',
                    hint: 'æç¤ºï¼šé€‰æ‹©é€‚åˆä½ å¹´çº§çš„æ¨¡å¼ï¼',
                    viewHint: 'æŸ¥çœ‹æç¤º',
                    hideHint: 'éšè—æç¤º',
                    insectMission: 'æ•è™«ä»»åŠ¡',
                    selectArea: 'é€‰æ‹©åœ°åŒº',
                    urawa: 'æµ¦å’Œ',
                    omiya: 'å¤§å®«',
                    iwatsuki: 'å²©æ§»',
                    cicada: 'è‰',
                    cicadaFact: 'åœ¨å¤§å®«å…¬å›­æœ‰å¾ˆå¤šè‰åœ¨å«ã€‚',
                    beetle: 'ç”²è™«',
                    beetleFact: 'ç”²è™«åœ¨æµ¦å’Œå¾ˆå—æ¬¢è¿Žã€‚',
                    dragonfly: 'èœ»èœ“',
                    dragonflyFact: 'èœ»èœ“åœ¨è§æ²¼ç”°åœƒé£žæ¥é£žåŽ»ã€‚',
                    attemptCapture: 'å°è¯•æ•æ‰',
                    captureInsect: 'æ¥æ•æ‰è™«å­',
                    captureSuccess: 'æ•æ‰æˆåŠŸï¼',
                    captureFail: 'é€ƒèµ°äº†ï¼'
                }
            };

            // insect capture helpers
            const startCapture = (insectKey) => {
                setCurrentInsect(insectKey);
                // Use addition problem for capture quiz (could be customized per insect)
                setCaptureQuestion(generateProblem('addition'));
                setCaptureResult(null);
                setGameState('insectQuiz');
            };

            const checkCaptureAnswer = (answer) => {
                if (!captureQuestion) return;
                if (answer === captureQuestion.answer) {
                    setCaptureResult('success');
                    if (currentInsect && !capturedInsects.includes(currentInsect)) {
                        setCapturedInsects(prev => [...prev, currentInsect]);
                    }
                } else {
                    setCaptureResult('fail');
                }
            };

            const t = translations[language];
            
            // Monster types with multilingual names
            const getMonsterTypes = () => {
                const monsterNames = {
                    ja: {
                        denkiryu: { name: 'ãƒ‡ãƒ³ã‚­ãƒªãƒ¥ã‚¦', desc: 'ã§ã‚“ãã‚¿ã‚¤ãƒ—ï¼ãŸã—ç®—ã§ ã“ã†ã’ãã ï¼' },
                        mizugame: { name: 'ãƒŸã‚ºã‚¬ãƒ¡', desc: 'ã¿ãšã‚¿ã‚¤ãƒ—ï¼ã²ãç®—ã® ã‚ã–ã‚’ ã¯ã¤ï¼' },
                        happamon: { name: 'ãƒãƒƒãƒ‘ãƒ¢ãƒ³', desc: 'ãã•ã‚¿ã‚¤ãƒ—ï¼ã‹ãšã® ã¡ã‹ã‚‰ã‚’ ãã‚‰ã¹ã‚‹ï¼' },
                        honoodon: { name: 'ãƒ›ãƒŽã‚ªãƒ‰ãƒ³', desc: 'ã»ã®ãŠã‚¿ã‚¤ãƒ—ï¼ã‚ã¤ã„ ãŸã—ç®—ã‚’ ã ã™ï¼' },
                        starion: { name: 'ã‚¹ã‚¿ãƒªã‚ªãƒ³', desc: 'ã»ã—ã‚¿ã‚¤ãƒ—ï¼ã‹ã‘ç®—ã® ã»ã—ã‚’ ãµã‚‰ã›ã‚‹ï¼' },
                        crystalos: { name: 'ã‚¯ãƒªã‚¹ã‚¿ãƒ­ã‚¹', desc: 'ã‚¯ãƒªã‚¹ã‚¿ãƒ«ã‚¿ã‚¤ãƒ—ï¼ã‚ã‚Šç®—ã§ ã“ã†ã’ãï¼' },
                        raidenking: { name: 'ãƒ©ã‚¤ãƒ‡ãƒ³ã‚­ãƒ³ã‚°', desc: 'ã§ã‚“ã›ã¤ã® ãƒœã‚¹ï¼ãŸãŠã•ãªã„ã¨ ã•ãã« ã™ã™ã‚ãªã„ï¼' },
                        mathemperor: { name: 'ãƒžã‚¹ã‚¨ãƒ³ãƒšãƒ©ãƒ¼', desc: 'ã•ã‚“ã™ã†ã® ã¦ã„ãŠã†ï¼ä¹ä¹ã‚’ ãƒžã‚¹ã‚¿ãƒ¼ã—ã¦ã„ã‚‹ï¼' }
                    },
                    en: {
                        denkiryu: { name: 'Electrox', desc: 'Electric type! Attacks with addition!' },
                        mizugame: { name: 'Aquaturtle', desc: 'Water type! Uses subtraction skills!' },
                        happamon: { name: 'Leafmon', desc: 'Grass type! Compares number powers!' },
                        honoodon: { name: 'Blazedon', desc: 'Fire type! Throws hot additions!' },
                        starion: { name: 'Starion', desc: 'Star type! Rains multiplication stars!' },
                        crystalos: { name: 'Crystalos', desc: 'Crystal type! Attacks with division!' },
                        raidenking: { name: 'Thunder King', desc: 'Legendary boss! Must defeat to proceed!' },
                        mathemperor: { name: 'Math Emperor', desc: 'Emperor of math! Master of times tables!' }
                    },
                    fr: {
                        denkiryu: { name: 'Ã‰lectryx', desc: 'Type Ã©lectrique! Attaque avec addition!' },
                        mizugame: { name: 'Aquatortue', desc: 'Type eau! Utilise la soustraction!' },
                        happamon: { name: 'Feuilmon', desc: 'Type plante! Compare les nombres!' },
                        honoodon: { name: 'Flammedon', desc: 'Type feu! Lance des additions brÃ»lantes!' },
                        starion: { name: 'Ã‰toilon', desc: 'Type Ã©toile! Pleut des multiplications!' },
                        crystalos: { name: 'Crystalos', desc: 'Type cristal! Attaque avec division!' },
                        raidenking: { name: 'Roi Tonnerre', desc: 'Boss lÃ©gendaire! Ã€ vaincre pour continuer!' },
                        mathemperor: { name: 'Empereur Math', desc: 'Empereur des maths! MaÃ®tre des tables!' }
                    },
                    zh: {
                        denkiryu: { name: 'ç”µé¾™', desc: 'ç”µç³»ï¼ç”¨åŠ æ³•æ”»å‡»ï¼' },
                        mizugame: { name: 'æ°´é¾Ÿ', desc: 'æ°´ç³»ï¼ä½¿ç”¨å‡æ³•æŠ€èƒ½ï¼' },
                        happamon: { name: 'å¶å…½', desc: 'è‰ç³»ï¼æ¯”è¾ƒæ•°å­—åŠ›é‡ï¼' },
                        honoodon: { name: 'ç«ç„°å…½', desc: 'ç«ç³»ï¼å‘å‡ºç‚½çƒ­çš„åŠ æ³•ï¼' },
                        starion: { name: 'æ˜Ÿå…½', desc: 'æ˜Ÿç³»ï¼é™ä¸‹ä¹˜æ³•ä¹‹æ˜Ÿï¼' },
                        crystalos: { name: 'æ°´æ™¶å…½', desc: 'æ°´æ™¶ç³»ï¼ç”¨é™¤æ³•æ”»å‡»ï¼' },
                        raidenking: { name: 'é›·çŽ‹', desc: 'ä¼ è¯´ä¸­çš„Bossï¼å¿…é¡»å‡»è´¥æ‰èƒ½å‰è¿›ï¼' },
                        mathemperor: { name: 'æ•°å­¦çš‡å¸', desc: 'æ•°å­¦çš„å¸çŽ‹ï¼æŽŒæ¡ä¹ä¹è¡¨ï¼' }
                    }
                };

                return [
                    // Grade 2 monsters
                    {
                        id: 'denkiryu',
                        name: monsterNames[language].denkiryu.name,
                        emoji: 'âš¡',
                        problemType: 'addition',
                        description: monsterNames[language].denkiryu.desc,
                        isBoss: false,
                        grade: 2,
                        health: 3
                    },
                    {
                        id: 'mizugame',
                        name: monsterNames[language].mizugame.name,
                        emoji: 'ðŸ¢',
                        problemType: 'subtraction',
                        description: monsterNames[language].mizugame.desc,
                        isBoss: false,
                        grade: 2,
                        health: 3
                    },
                    {
                        id: 'happamon',
                        name: monsterNames[language].happamon.name,
                        emoji: 'ðŸƒ',
                        problemType: 'comparison',
                        description: monsterNames[language].happamon.desc,
                        isBoss: false,
                        grade: 2,
                        health: 3
                    },
                    {
                        id: 'honoodon',
                        name: monsterNames[language].honoodon.name,
                        emoji: 'ðŸ”¥',
                        problemType: 'addition',
                        description: monsterNames[language].honoodon.desc,
                        isBoss: false,
                        grade: 2,
                        health: 3
                    },
                    // Grade 3 monsters
                    {
                        id: 'starion',
                        name: monsterNames[language].starion.name,
                        emoji: 'â­',
                        problemType: 'multiplication',
                        description: monsterNames[language].starion.desc,
                        isBoss: false,
                        grade: 3,
                        health: 3
                    },
                    {
                        id: 'crystalos',
                        name: monsterNames[language].crystalos.name,
                        emoji: 'ðŸ’Ž',
                        problemType: 'division',
                        description: monsterNames[language].crystalos.desc,
                        isBoss: false,
                        grade: 3,
                        health: 3
                    },
                    // Boss monsters
                    {
                        id: 'raidenking',
                        name: monsterNames[language].raidenking.name,
                        emoji: 'ðŸ‘‘',
                        problemType: 'addition',
                        description: monsterNames[language].raidenking.desc,
                        isBoss: true,
                        grade: 2,
                        health: 5
                    },
                    {
                        id: 'mathemperor',
                        name: monsterNames[language].mathemperor.name,
                        emoji: 'ðŸ°',
                        problemType: 'multiplication',
                        description: monsterNames[language].mathemperor.desc,
                        isBoss: true,
                        grade: 3,
                        health: 7
                    }
                ];
            };
            
            // Game state
            const [gameState, setGameState] = useState('menu');
            const [currentLevel, setCurrentLevel] = useState(1);
            const [selectedGrade, setSelectedGrade] = useState(2);
            const [playerPosition, setPlayerPosition] = useState({ x: 0, y: 0 });
            const [maze, setMaze] = useState([]);
            const [mazeSize, setMazeSize] = useState(5);
            const [monsterPositions, setMonsterPositions] = useState([]);
            const [defeatedMonsters, setDefeatedMonsters] = useState([]);
            const [currentMonster, setCurrentMonster] = useState(null);
            const [battleState, setBattleState] = useState(null);
            const [bossGates, setBossGates] = useState([]);
            const [requiredBosses, setRequiredBosses] = useState([]);
            const [timeLeft, setTimeLeft] = useState(30);
            const [message, setMessage] = useState('');
            const [showHint, setShowHint] = useState(false);
            const [selectedArea, setSelectedArea] = useState(null);
            const [currentInsect, setCurrentInsect] = useState(null);
            const [captureQuestion, setCaptureQuestion] = useState(null);
            const [captureResult, setCaptureResult] = useState(null);
            const [capturedInsects, setCapturedInsects] = useState([]);
            const [playerStats, setPlayerStats] = useState({
                totalMonstersDefeated: 0,
                totalQuestionsAnswered: 0,
                correctAnswers: 0,
                unlockedMonsters: [],
                badges: []
            });

            const areaInsects = {
                urawa: { insect: 'beetle' },
                omiya: { insect: 'cicada' },
                iwatsuki: { insect: 'dragonfly' }
            };

            // Language selector component
            const LanguageSelector = () => (
                <div className="flex justify-center gap-2 mb-4">
                    <button 
                        onClick={() => setLanguage('ja')} 
                        className={`px-3 py-1 rounded text-sm font-bold transition-all ${
                            language === 'ja' 
                                ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg' 
                                : 'bg-gray-300 hover:bg-gray-400'
                        }`}
                    >
                        æ—¥æœ¬èªž
                    </button>
                    <button 
                        onClick={() => setLanguage('en')} 
                        className={`px-3 py-1 rounded text-sm font-bold transition-all ${
                            language === 'en' 
                                ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg' 
                                : 'bg-gray-300 hover:bg-gray-400'
                        }`}
                    >
                        EN
                    </button>
                    <button 
                        onClick={() => setLanguage('fr')} 
                        className={`px-3 py-1 rounded text-sm font-bold transition-all ${
                            language === 'fr' 
                                ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg' 
                                : 'bg-gray-300 hover:bg-gray-400'
                        }`}
                    >
                        FR
                    </button>
                    <button 
                        onClick={() => setLanguage('zh')} 
                        className={`px-3 py-1 rounded text-sm font-bold transition-all ${
                            language === 'zh' 
                                ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg' 
                                : 'bg-gray-300 hover:bg-gray-400'
                        }`}
                    >
                        ä¸­æ–‡
                    </button>
                </div>
            );

            // Save language preference
            useEffect(() => {
                const saved = localStorage.getItem('gameLanguage');
                if (saved && translations[saved]) setLanguage(saved);
            }, []);

            useEffect(() => {
                localStorage.setItem('gameLanguage', language);
            }, [language]);

            // Generate maze (fixed version)
            const generateMaze = useCallback((size) => {
                const newMaze = Array(size).fill().map(() => Array(size).fill(0));
                
                // Add walls more strategically
                for (let i = 0; i < size; i++) {
                    for (let j = 0; j < size; j++) {
                        if (Math.random() < 0.2 && !(i === 0 && j === 0) && !(i === size-1 && j === size-1)) {
                            newMaze[i][j] = 1; // Wall
                        }
                    }
                }
                
                // Ensure path exists from start to goal
                newMaze[0][0] = 0; // Start
                newMaze[size-1][size-1] = 2; // Goal
                
                // Clear a basic path
                for (let i = 0; i < size - 1; i++) {
                    if (Math.random() < 0.5) {
                        newMaze[i][i] = 0;
                        newMaze[i][i+1] = 0;
                    } else {
                        newMaze[i][i] = 0;
                        newMaze[i+1][i] = 0;
                    }
                }
                
                // Add gate if level > 3
                const gates = [];
                const bosses = [];
                if (currentLevel > 3 && size >= 7) {
                    const gateY = size - 2;
                    const gateX = size - 1;
                    if (newMaze[gateY][gateX] === 0) {
                        newMaze[gateY][gateX] = 3; // Gate
                        gates.push({ x: gateX, y: gateY, id: 'gate-1' });
                    }
                }
                
                // Get grade-appropriate monsters
                const monsterTypes = getMonsterTypes();
                const gradeMonsters = monsterTypes.filter(m => m.grade === selectedGrade);
                const normalMonsters = gradeMonsters.filter(m => !m.isBoss);
                const bossMonsters = gradeMonsters.filter(m => m.isBoss);
                
                // Add monsters
                const monsters = [];
                
                // Add boss if there's a gate
                if (gates.length > 0 && bossMonsters.length > 0) {
                    let bossPlaced = false;
                    for (let attempts = 0; attempts < 50 && !bossPlaced; attempts++) {
                        const x = Math.floor(Math.random() * (size - 2)) + 1;
                        const y = Math.floor(Math.random() * (size - 2)) + 1;
                        
                        if (newMaze[y][x] === 0 && 
                            !(x === 0 && y === 0) && 
                            !(x === size-1 && y === size-1)) {
                            const bossType = bossMonsters[Math.floor(Math.random() * bossMonsters.length)];
                            const bossMonster = { 
                                x, 
                                y, 
                                type: bossType,
                                id: `boss-${gates[0].id}`,
                                isBoss: true
                            };
                            monsters.push(bossMonster);
                            bosses.push(bossMonster.id);
                            bossPlaced = true;
                        }
                    }
                }
                
                // Add normal monsters
                const monsterCount = Math.min(Math.floor(size / 2), 4);
                for (let i = 0; i < monsterCount; i++) {
                    let placed = false;
                    let attempts = 0;
                    while (!placed && attempts < 50) {
                        const x = Math.floor(Math.random() * size);
                        const y = Math.floor(Math.random() * size);
                        if (newMaze[y][x] === 0 && 
                            !(x === 0 && y === 0) && 
                            !(x === size-1 && y === size-1) &&
                            !monsters.some(m => m.x === x && m.y === y)) {
                            const monsterType = normalMonsters[Math.floor(Math.random() * normalMonsters.length)];
                            monsters.push({ 
                                x, 
                                y, 
                                type: monsterType,
                                id: `monster-${i}`,
                                isBoss: false
                            });
                            placed = true;
                        }
                        attempts++;
                    }
                }
                
                setMaze(newMaze);
                setMonsterPositions(monsters);
                setBossGates(gates);
                setRequiredBosses(bosses);
                setPlayerPosition({ x: 0, y: 0 });
                setDefeatedMonsters([]);
            }, [currentLevel, selectedGrade, language]);

            // Generate problem (fixed comparison)
            const generateProblem = (type) => {
                let problem = {};

                switch (type) {
                    case 'addition':
                        const add_a = Math.floor(Math.random() * 20) + 1;
                        const add_b = Math.floor(Math.random() * 20) + 1;
                        problem = {
                            question: `${add_a} + ${add_b} = ?`,
                            answer: add_a + add_b,
                            options: generateOptions(add_a + add_b, 2, 40),
                            hint: `${add_a} + ${add_b} = ?`
                        };
                        break;

                    case 'subtraction':
